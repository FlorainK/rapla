stages:
    - maven_build
    - image_build

cache:
    paths:
        - .m2/repository

maven_build:
    stage: maven_build
    image: maven:3.6.3-jdk-11
    script:
        - mvn package -DskipTests
    artifacts:
        paths:
            - target/*.war
    tags:
        - rapla

image_build:
    stage: image_build
    image: docker:24.0.5
    services:
        - name: docker:24.0.5-dind
          alias: docker
    variables:
        DOCKER_HOST: tcp://docker:2375
        DOCKER_TLS_CERTDIR: ""
    script:
        - docker info
        - docker image build -t rapla .
    tags:
        - rapla
